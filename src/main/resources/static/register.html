<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register â€” PowerBill</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="auth-page">
<div id="alertBox"></div>
<div class="container">
  <div class="form-container" style="max-width:520px;">
    <div class="auth-logo">âš¡</div>
    <h2>Create <span>Account</span></h2>
    <p class="text-center text-muted mb-4">Choose your role and fill in your details</p>

    <!-- Role Selector -->
    <div class="row g-3 mb-4" id="roleSelector">
      <div class="col-6">
        <div class="role-card" id="adminCard" onclick="selectRole('ADMIN')">
          <div class="role-icon">ğŸ›¡ï¸</div>
          <div class="fw-bold">Admin</div>
          <small class="text-muted">Manage system</small>
        </div>
      </div>
      <div class="col-6">
        <div class="role-card" id="customerCard" onclick="selectRole('CUSTOMER')">
          <div class="role-icon">ğŸ‘¤</div>
          <div class="fw-bold">Customer</div>
          <small class="text-muted">View my bills</small>
        </div>
      </div>
    </div>

    <form id="registerForm" onsubmit="handleRegister(event)">
      <input type="hidden" id="selectedRole" value="">

      <div class="mb-3">
        <label class="form-label">Username</label>
        <input type="text" id="regUsername" class="form-control" placeholder="Choose a username" required minlength="3">
      </div>
      <div class="mb-3">
        <label class="form-label">Password</label>
        <input type="password" id="regPassword" class="form-control" placeholder="Create a password" required minlength="4">
      </div>

      <!-- Customer-only fields -->
      <div id="customerFields" style="display:none;">
        <hr><p class="fw-bold text-muted small mb-2">Customer Profile Details</p>
        <div class="mb-3">
          <label class="form-label">Full Name</label>
          <input type="text" id="regName" class="form-control" placeholder="e.g. Ravi Kumar">
        </div>
        <div class="mb-3">
          <label class="form-label">Email Address</label>
          <input type="email" id="regEmail" class="form-control" placeholder="e.g. ravi@example.com">
        </div>
        <div class="mb-3">
          <label class="form-label">Address</label>
          <input type="text" id="regAddress" class="form-control" placeholder="e.g. 123 MG Road, Hyderabad">
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100 py-2 mt-2" id="registerBtn">Create Account</button>
    </form>

    <p class="text-center mt-4 text-muted">Already have an account? <a href="login.html" class="text-primary fw-bold">Login</a></p>
    <p class="text-center"><a href="index.html" class="text-muted small">â† Back to Home</a></p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/app.js"></script>
<script>
  function selectRole(role) {
    document.getElementById('selectedRole').value = role;
    document.getElementById('adminCard').className    = 'role-card' + (role === 'ADMIN'    ? ' selected-admin' : '');
    document.getElementById('customerCard').className = 'role-card' + (role === 'CUSTOMER' ? ' selected-customer' : '');
    document.getElementById('customerFields').style.display = role === 'CUSTOMER' ? 'block' : 'none';
  }

  async function handleRegister(e) {
    e.preventDefault();
    const role = document.getElementById('selectedRole').value;
    if (!role) { showAlert('Please select a role (Admin or Customer)', 'warning'); return; }

    const body = {
      username: document.getElementById('regUsername').value.trim(),
      password: document.getElementById('regPassword').value,
      role
    };

    if (role === 'CUSTOMER') {
      body.name    = document.getElementById('regName').value.trim();
      body.email   = document.getElementById('regEmail').value.trim();
      body.address = document.getElementById('regAddress').value.trim();
    }

    const btn = document.getElementById('registerBtn');
    btn.disabled = true; btn.textContent = 'Registering...';

    try {
      await apiFetch('/api/register', 'POST', body);
      showAlert('Account created! Redirecting to login...', 'success');
      setTimeout(() => window.location.href = 'login.html', 1500);
    } catch (err) {
      showAlert('Registration failed: ' + err.message, 'danger');
      btn.disabled = false; btn.textContent = 'Create Account';
    }
  }
</script>
</body>
</html>
